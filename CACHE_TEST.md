# 缓存功能测试指南

## 测试目标

验证SparkLog应用的缓存机制和同步功能是否正常工作。

## 测试步骤

### 1. 缓存机制测试

#### 1.1 首次加载测试
1. 打开应用首页
2. 观察控制台日志，应该看到：
   - "从GitHub API获取数据"
   - "笔记已缓存到本地: X个笔记"

#### 1.2 缓存使用测试
1. 刷新页面
2. 观察控制台日志，应该看到：
   - "从本地缓存加载笔记: X个笔记"
   - "使用缓存数据，跳过API调用"

#### 1.3 缓存状态显示测试
1. 使用缓存数据时，页面应显示：
   - "📦 使用缓存数据 (X个笔记)"
   - "上次同步: [时间]"

### 2. 同步功能测试

#### 2.1 同步按钮测试
1. 点击同步按钮（刷新图标）
2. 观察按钮状态：
   - 图标应该旋转
   - 按钮应该禁用
3. 同步完成后：
   - 显示"同步完成！"消息
   - 按钮恢复正常状态

#### 2.2 强制同步测试
1. 在GitHub仓库中手动添加一个笔记文件
2. 点击同步按钮
3. 验证新笔记是否出现在列表中

### 3. 缓存失效测试

#### 3.1 新建笔记缓存清除
1. 创建新笔记
2. 保存后返回首页
3. 验证缓存是否被清除（应该重新从GitHub加载）

#### 3.2 编辑笔记缓存清除
1. 编辑现有笔记
2. 保存后返回首页
3. 验证缓存是否被清除

#### 3.3 删除笔记缓存清除
1. 删除一个笔记
2. 验证缓存是否被清除

### 4. 登录状态缓存测试

#### 4.1 游客模式缓存
1. 未登录状态下加载笔记
2. 验证只显示公开笔记
3. 缓存应该只包含公开笔记

#### 4.2 管理员模式缓存
1. 登录管理员账户
2. 验证显示所有笔记（包括私密笔记）
3. 缓存应该包含所有笔记

### 5. 缓存过期测试

#### 5.1 手动清除缓存
1. 打开浏览器开发者工具
2. 进入Application > Local Storage
3. 删除`sparklog_notes_cache_guest`或`sparklog_notes_cache_admin`
4. 刷新页面，应该重新从GitHub加载数据

## 预期结果

### 成功指标
- ✅ 首次加载时从GitHub获取数据并缓存
- ✅ 后续访问时优先使用缓存数据
- ✅ 缓存状态正确显示
- ✅ 同步按钮正常工作
- ✅ 数据操作后缓存正确清除
- ✅ 登录状态改变时缓存正确清除
- ✅ 缓存过期后自动重新加载

### 性能指标
- 首次加载时间：< 3秒
- 缓存加载时间：< 1秒
- API调用次数：显著减少
- 用户体验：流畅无卡顿

## 故障排除

### 常见问题

1. **缓存不生效**
   - 检查LocalStorage是否启用
   - 检查浏览器控制台是否有错误

2. **同步失败**
   - 检查网络连接
   - 检查GitHub API限制
   - 检查认证状态

3. **缓存状态不显示**
   - 检查MessageContext是否正确配置
   - 检查Layout组件是否正确渲染

### 调试信息

在浏览器控制台中查看以下日志：
- 缓存相关：`笔记已缓存到本地`、`从本地缓存加载笔记`
- 同步相关：`开始强制同步`、`同步完成`
- 错误信息：`加载笔记失败`、`同步失败`

## 测试环境

- 浏览器：Chrome 120+
- 网络：正常网络连接
- GitHub：有效的API Token
- 仓库：包含测试笔记的GitHub仓库 