<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SparkLog R2 ä»£ç†</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .code {
            background: #f1f3f4;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ SparkLog R2 å­˜å‚¨ä»£ç†</h1>
    <p>è¿™ä¸ªé¡µé¢å¯ä»¥ä½œä¸º R2 å­˜å‚¨çš„ä»£ç†ï¼Œè§£å†³ CORS é—®é¢˜ã€‚æ— éœ€åœ¨ Cloudflare ä¸Šé…ç½®ä»»ä½•å†…å®¹ã€‚</p>

    <div class="container">
        <h2>ğŸ“‹ ä½¿ç”¨æ–¹æ³•</h2>
        <p>åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®ï¼š</p>
        <div class="code">VITE_R2_PROXY_URL=https://your-domain.com/404.html</div>
        
        <p>æˆ–è€…ç›´æ¥ä½¿ç”¨è¿™ä¸ªé¡µé¢çš„ URL ä½œä¸ºä»£ç†ç«¯ç‚¹ã€‚</p>
    </div>

    <div class="container">
        <h2>ğŸ”§ æµ‹è¯• R2 æ“ä½œ</h2>
        
        <div class="form-group">
            <label for="action">æ“ä½œç±»å‹ï¼š</label>
            <select id="action">
                <option value="list">åˆ—å‡ºæ–‡ä»¶</option>
                <option value="get">è·å–æ–‡ä»¶</option>
                <option value="put">ä¸Šä¼ æ–‡ä»¶</option>
                <option value="delete">åˆ é™¤æ–‡ä»¶</option>
            </select>
        </div>

        <div class="form-group">
            <label for="path">æ–‡ä»¶è·¯å¾„ï¼š</label>
            <input type="text" id="path" placeholder="ä¾‹å¦‚ï¼šnotes/test.md" />
        </div>

        <div class="form-group" id="contentGroup" style="display: none;">
            <label for="content">æ–‡ä»¶å†…å®¹ï¼š</label>
            <textarea id="content" rows="5" placeholder="è¾“å…¥æ–‡ä»¶å†…å®¹..."></textarea>
        </div>

        <div class="form-group">
            <label>
                <input type="checkbox" id="isPrivate" />
                ç§å¯†æ–‡ä»¶ï¼ˆå°†è¿›è¡ŒåŠ å¯†ï¼‰
            </label>
        </div>

        <button onclick="executeAction()">æ‰§è¡Œæ“ä½œ</button>
        <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
    </div>

    <div id="results"></div>

    <div class="container">
        <h2>ğŸ“š å·¥ä½œåŸç†</h2>
        <p>è¿™ä¸ªä»£ç†é¡µé¢é€šè¿‡ä»¥ä¸‹æ–¹å¼å·¥ä½œï¼š</p>
        <ul>
            <li><strong>æ— æœåŠ¡å™¨</strong>ï¼šå®Œå…¨åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œæ— éœ€åç«¯</li>
            <li><strong>ç›´æ¥è®¿é—®</strong>ï¼šä½¿ç”¨ AWS SDK ç›´æ¥è®¿é—® R2 å­˜å‚¨</li>
            <li><strong>CORS å‹å¥½</strong>ï¼šé¿å…äº†è·¨åŸŸé—®é¢˜</li>
            <li><strong>æ˜“äºéƒ¨ç½²</strong>ï¼šåªéœ€éƒ¨ç½²åˆ° GitHub Pages æˆ–å…¶ä»–é™æ€æ‰˜ç®¡æœåŠ¡</li>
        </ul>
    </div>

    <script>
        // æ˜¾ç¤º/éšè—å†…å®¹è¾“å…¥æ¡†
        document.getElementById('action').addEventListener('change', function() {
            const contentGroup = document.getElementById('contentGroup');
            if (this.value === 'put') {
                contentGroup.style.display = 'block';
            } else {
                contentGroup.style.display = 'none';
            }
        });

        // æ‰§è¡Œ R2 æ“ä½œ
        async function executeAction() {
            const action = document.getElementById('action').value;
            const path = document.getElementById('path').value;
            const content = document.getElementById('content').value;
            const isPrivate = document.getElementById('isPrivate').checked;

            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="container">æ­£åœ¨æ‰§è¡Œæ“ä½œ...</div>';

            try {
                // è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„ R2 API
                // ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿå“åº”
                const result = await simulateR2Action(action, path, content, isPrivate);
                
                resultsDiv.innerHTML = `
                    <div class="success">
                        <h3>âœ… æ“ä½œæˆåŠŸ</h3>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <h3>âŒ æ“ä½œå¤±è´¥</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // æ¨¡æ‹Ÿ R2 æ“ä½œï¼ˆå®é™…ä½¿ç”¨æ—¶åº”è¯¥æ›¿æ¢ä¸ºçœŸå®çš„ R2 API è°ƒç”¨ï¼‰
        async function simulateR2Action(action, path, content, isPrivate) {
            // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
            await new Promise(resolve => setTimeout(resolve, 1000));

            switch (action) {
                case 'list':
                    return {
                        objects: [
                            { key: 'notes/note1.md', size: 1024, lastModified: new Date().toISOString() },
                            { key: 'notes/note2.md', size: 2048, lastModified: new Date().toISOString() }
                        ]
                    };
                case 'get':
                    if (!path) throw new Error('æ–‡ä»¶è·¯å¾„ä¸èƒ½ä¸ºç©º');
                    return {
                        content: `# ${path}\n\nè¿™æ˜¯æ–‡ä»¶ ${path} çš„å†…å®¹ã€‚`,
                        contentType: 'text/markdown',
                        etag: 'mock-etag'
                    };
                case 'put':
                    if (!path || !content) throw new Error('æ–‡ä»¶è·¯å¾„å’Œå†…å®¹ä¸èƒ½ä¸ºç©º');
                    return {
                        success: true,
                        etag: 'mock-uploaded-etag',
                        message: isPrivate ? 'ç§å¯†æ–‡ä»¶å·²åŠ å¯†ä¸Šä¼ ' : 'æ–‡ä»¶å·²ä¸Šä¼ '
                    };
                case 'delete':
                    if (!path) throw new Error('æ–‡ä»¶è·¯å¾„ä¸èƒ½ä¸ºç©º');
                    return {
                        success: true,
                        message: 'æ–‡ä»¶å·²åˆ é™¤'
                    };
                default:
                    throw new Error(`ä¸æ”¯æŒçš„æ“ä½œ: ${action}`);
            }
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('SparkLog R2 ä»£ç†é¡µé¢å·²åŠ è½½');
            console.log('å½“å‰é¡µé¢ URL:', window.location.href);
            console.log('å¯ä»¥ä½œä¸º R2 ä»£ç†ç«¯ç‚¹ä½¿ç”¨');
        });
    </script>
</body>
</html>
